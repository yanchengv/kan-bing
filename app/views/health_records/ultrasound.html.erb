<%= javascript_include_tag 'jquery.fancybox-1.3.1.pack' %>
<%= stylesheet_link_tag 'fancybox' %>
<style>
    .black_overlay{
        display: none;
        position: absolute;
        top: 0%;  left: 0%;  width: 100%;  height: 100%;
        background-color: black;
        z-index:1001;
        -moz-opacity: 0.8;
        opacity:.80;
        /*filter: alpha(opacity=80);*/
    }
    .white_content {
        display: none;
        position: absolute;
        top: 10%;  left: 25%;  width: 560px;  height: 450px;
        padding: 16px;
        /*border: 16px solid orange;*/
        background-color: white;
        z-index:1002;
        overflow: auto;
    }
</style>
<div id="light" class="white_content">
  <button onclick="closeBtn()">关闭</button>
  <iframe style="overflow: hidden;" height="405px" width="540px" id="videoPlayer" name="videoPlayer" src="/health_records/get_video"></iframe>
</div>
<div id="fade" class="black_overlay">
</div>
<div id="fade" class="container bgcolor-purple" style="margin-top:-20px;">

  <div id="videoPlayer" style="width: 100%;height: 100%">

  </div>
  <div id="ultrasound" style="float: left">
    <img width="540px" height="720px" src="/dione/pdf_reports/show_picture?uuid=<%= @uuid %>">
  </div>
  <div id="pictures" style="float: left">

  </div>
  <div id="videos" style="float: left">
    <table>
      <tr>
        <td style="width: 450px">视频</td>
        <td>播放</td>
      </tr>
    </table>
  </div>
</div>
<script>
    $(function(){
        var cWidth = $('.container').width();
        var iWidth = (cWidth-600)/2;
        $.ajax({
            url: '/dione/pdf_reports/download_emr_img_video?uuid=<%= @uuid.sub(".png",".xml") %>',
            type: 'get',
            success: function(data){
                var images = data.images;
                var videos = data.videos;
                var iLen = images.length;
                var vLen = videos.length;
                if(iLen > 0){
                    for(var i= 0;i<iLen;i++){
                        $('#pictures').append('<a class="pictures" href="'+images[i]+'"><img width="'+iWidth+'px" src="'+images[i]+'"></a>');
                        if(i!=0&&i%2==1)$('#pictures').append('<br/>');
                    }
                    $('.pictures').fancybox();
                }

                if(vLen > 0){
                    var k = 0;
                    for(var i= 0;i<vLen;i++){
                        k = i+1;
                        $('#videos table').append('<tr><td>视频'+k+'</td><td><img src="/icon/videoStart.png" onclick="videoStart(\''+videos[i]+'\');" /></td></tr>');
                    }
                }
            },
            error: function(data){
                console.log(data);
            }
        })
    });
    function videoStart(url){
        url = (url.substring(1,3)+'/'+url.substring(4,6)+'/'+url.substring(7,9)+'/'+url.substring(10)).split('.')[0];

        console.log(url);
        document.getElementById('light').style.display='block';
        document.getElementById('fade').style.display='block';
        $(window.frames['videoPlayer'].document).find('embed')[0].updateHost('<%= @ip %>','vod');
        $(window.frames['videoPlayer'].document).find('embed')[0].playVideo("b4/5c/3d/9d4917bce2b229e858ef1e");
    }
    function closeBtn(){
        document.getElementById('light').style.display='none';
        document.getElementById('fade').style.display='none';
    }
</script>