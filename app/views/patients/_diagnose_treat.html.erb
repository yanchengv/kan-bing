<div class="row index_box" id="zhenliao" style="margin-top:10px; background:#edeef1;">
<p class="box-title font-18 font-yahei" style="padding-left:15px;margin-bottom:0px;">
  <b class="pull-left">诊疗</b>
  <strong class="pull-right" style="border-left:1px solid #d7d7d7;color:#ababab;font-size:30px;width:45px;display:inline-block;text-align:center;cursor:pointer;" data-toggle="modal" data-target="#diagnoseTreatModal">+</strong>
</p>

<div class="col-md-3 col-sm-5" style="padding:0;">
  <!--效果html开始-->
  <div id="zsgun">
    <a href="#" class="prenext zspre"></a>
    <a href="#" class="prenext zsnext"></a>
    <div id="gundiv" class="container2">
      <ul>
        <% if !@diagnose_treats.empty?%>
            <% @diagnose_treats.each do |dt|%>
                <li>
                  <p class="pull-right zhenliao_edit">
                  <p class="pull-right zhenliao_edit">
                    <%=image_tag "edit.png" ,:style=> "width:12px;margin-right:15px;"%>
                    <%=image_tag "delete.png" ,:style=> "width:12px;",onclick:"get_destroy_treat_modal('#{dt.id}','#{dt.name}')"%>

                  </p>

                  <div style="clear:both;"></div>

                  </p>
                  <div style="clear:both;"></div>
                  <p class="zhenliao_title"  style= "cursor:pointer" onclick="showRightDiagonse(<%= dt.id%>,<%=dt.patient_id %>)"><%= dt.name%></p>
                  <p>
                    <span class="pull-left zhenliao_info"><%=image_tag "user2.png" ,:style => "width:12px;"%><%= dt.doctor_name%></span>
                    <span class="pull-right zhenliao_info"><%=image_tag "time.png" ,:style => "width:12px;"%><%= dt.create_time%></span>
                  </p>
                </li>
            <%end%>

        <%end%>


      </ul>
    </div>
  </div>

  <!--效果html结束-->
</div>




<div class="col-md-9 col-sm-7" id="zhenliao_con">
  <!--主诉-->
  <div class="row" style="margin-top:25px;">
    <div class="col-md-10 zhusu_box col-md-offset-1" id="main1">
      <div class="row">
        <div class="col-md-2 col-sm-2 col-xs-4 text-center" style="background:#3abaeb;" id="left1">
          <%=image_tag "zhusu.png" ,:style => "margin:10px 0;"%>
        </div>
        <div class="col-md-10 col-sm-10 col-xs-8" id="right1">
          <p>
            <span class="pull-left zhenliao_title">主诉</span>
                     <span class="pull-right zhusu_btn">
                       <!--<button class="btn btn-xs btn-success">添加</button>-->
                       <button class="btn btn-xs btn-primary" onclick="updateMainTell(<%= @diagnose_treat_id%>)">修改</button>
                     </span>
          </p>
          <div style="clear:both;"></div>
          <p class="zhusu_con">
            <%if !@main_tell.nil?%>
            <%= @main_tell.tell_content%>
            主诉者:<%=@main_tell.teller %>
            <%end%>
          </p>
        </div>
      </div>
      <div style="clear:both;"></div>
    </div>

  </div>
  <!--诊断-->
  <div class="row" style="margin-top:10px;">
    <div class="col-md-10 zhusu_box col-md-offset-1" id="main2">
      <div class="row">
        <div class="col-md-2 col-sm-2 col-xs-4 text-center" id="left2" style="background:#3abaeb;">
          <%=image_tag "zhenduan.png" ,:style => "margin:10px 0;"%>
        </div>
        <div class="col-md-10 col-sm-10 col-xs-8" id="right2">
          <p>
            <span class="pull-left zhenliao_title">诊断</span>
                     <span class="pull-right zhusu_btn">
                       <!--<button class="btn btn-xs btn-success">添加</button>-->
                       <button class="btn btn-xs btn-primary" onclick="updateDiagnose(<%= @diagnose_treat_id%>)">修改</button>
                     </span>
          </p>
          <div style="clear:both;"></div>
          <%if !@diagnose.nil?%>
          <p class="zhusu_con">
            <%= @diagnose.content%>
          </p>
          <p>
            <span class="pull-right zhenliao_info"><%=image_tag "time.png" ,:style => "width:14px;"%><%= @diagnose.create_time%></span>
            <span class="pull-right zhenliao_info"><%=image_tag "user2.png" ,:style => "width:14px;"%>医生 <%= @diagnose.doctor_name%></span>
          </p>
              <%end%>
        </div>

      </div>
      <div style="clear:both;"></div>
    </div>
  </div>
  <!--时间轴-->
  <div class="row">
    <div class="col-md-10 zhusu_box col-md-offset-1" style="background:#f2f5f8">
      <!--时间轴上面的线-->
      <div class="row">
        <div class="col-md-2 col-sm-3 col-xs-3  col-md-offset-2 col-sm-offset-3 col-xs-offset-3">
          <%=image_tag "timeline_top.jpg"%>
        </div>
      </div>
      <!--时间轴内容部分-->
      <!--影响数据模块-->
      <div class="row">
        <div class="col-md-2 col-sm-3 col-xs-3 timeline">
          <p class="zhenliao_title">2015/1/7</p>
          <p class="timeline_t">09:30</p>
        </div>
        <div class="col-md-2 col-sm-3 col-xs-3 timeline">
          <%=image_tag "timeline.jpg"%>
        </div>
        <div class="col-md-8 col-sm-6 col-xs-6" style="padding-left:0px;">
          <div class="timeline_box">
            <p class="timeline_box_t">CT影像数据</p>
            <ul class="timeline_img">
              <li><a><%=image_tag "http://ww1.sinaimg.cn/large/005yyi5Jjw1eo7ofmog2rj301y01y3ya.jpg" %></a></li>
              <li><a><%=image_tag "http://ww1.sinaimg.cn/large/005yyi5Jjw1eo7ofmog2rj301y01y3ya.jpg" %></a></li>
              <li><a><%=image_tag "http://ww1.sinaimg.cn/large/005yyi5Jjw1eo7ofmog2rj301y01y3ya.jpg" %></a></li>
              <li><a><%=image_tag "http://ww1.sinaimg.cn/large/005yyi5Jjw1eo7ofmog2rj301y01y3ya.jpg" %></a></li>
            </ul>
          </div>
        </div>
      </div>
      <!--检验报告模块-->
      <div class="row">
        <div class="col-md-2 col-sm-3 col-xs-3  timeline">
          <p class="zhenliao_title">2015/1/6</p>
          <p class="timeline_t">09:30</p>
        </div>
        <div class="col-md-2 col-sm-3 col-xs-3  timeline">
          <%=image_tag "timeline.jpg"%>
        </div>
        <div class="col-md-8 col-sm-6 col-xs-6 " style="padding-left:0px;">
          <div class="timeline_box">
            <p class="timeline_box_t">CT影像数据</p>
            <p class="timeline_jianyan_img"><%=image_tag "http://ww1.sinaimg.cn/large/005yyi5Jjw1eo7p53xz43j31kw16h0xe.jpg"%></p>
          </div>
        </div>
      </div>
      <!--时间轴下面的线-->
      <div class="row">
        <div class="col-md-2 col-sm-3 col-xs-3  col-md-offset-2 col-sm-offset-3 col-xs-offset-3">
          <%=image_tag "timeline_top.jpg"%>
        </div>
      </div>
      <div style="clear:both;"></div>
    </div>
  </div>
  <!--时间轴 end-->
  <div style="clear:both;"></div>
  <!--医嘱-->
  <div class="row" style="margin-top:10px;">
    <div class="col-md-10 zhusu_box col-md-offset-1" id="main3" >
      <div class="row">
        <div class="col-md-2 col-sm-2 col-xs-4 text-center" id="left3" style="background:#3abaeb;">
          <%=image_tag "yizhu.png" ,:style => "margin:10px 0;"%>
        </div>
        <div class="col-md-10 col-sm-10 col-xs-8" id="right3">
          <p>
            <span class="pull-left zhenliao_title">医嘱</span>
                     <span class="pull-right zhusu_btn">
                       <button class="btn btn-xs btn-success">添加</button>
                       <button class="btn btn-xs btn-primary">修改</button>
                     </span>
          </p>
          <div style="clear:both;"></div>
          <table class="yizhu_table">
            <tr>
              <th style="border-left:0px;width:10%">下达时间</th>
              <th style="width:20%;">执行起始时间</th>
              <th>时间长度</th>
              <th>下达医生</th>
              <th>执行人</th>
              <th style="width:25%">内容</th>
              <th>类型</th>
            </tr>
            <% if !@doctor_orders.empty?%>
                <%@doctor_orders.each do |order|%>
                    <tr>
                      <td style="border-left:0px;"><%= order.create_time%></td>
                      <td><%= order.start_time%></td>
                      <td><%= order.valid_time%></td>
                      <td><%= order.doctor_name%></td>
                      <td><%= order.executor%></td>
                      <td><%= order.content%></td>
                      <td><%= order.order_type%></td>
                    </tr>
                    <%end%>

             <%end%>


            <!--别删下面的是样式标签-->
            <tr>
              <td style="border-bottom:0px;border-left:0px;"></td>
              <td style="border-bottom:0px;"></td>
              <td style="border-bottom:0px;"></td>
              <td style="border-bottom:0px;"></td>
              <td style="border-bottom:0px;"></td>
              <td style="border-bottom:0px;"></td>
              <td style="border-bottom:0px;"></td>
            </tr>
          </table>
        </div>

      </div>
      <div style="clear:both;"></div>
    </div>
  </div>
</div>

</div>

<%= render 'patients/diagnose_treat_form'%>






<script type="text/javascript">
    //时间控件,显示时间
    var nowDate = new Date();
    nowDate=nowDate.getFullYear()+'/'+(nowDate.getMonth()+1)+'/'+nowDate.getDate()+'  '+nowDate.getHours()+':'+nowDate.getMinutes();
    $('#diagnose_treat_create_time').datetimepicker({
        lang:'ch',
        value: nowDate,
        timepicker:true,
        customformat:'Y-m-d H:m'
    });


    //滚动条
    $(function() {
        var glen = $("#gundiv ul li").length;
        $("#gundiv ul").css("height",292 * (glen));
        $("#gundiv li").hover(function(){$("#gundiv li").removeClass("zslion");$(this).addClass("zslion");},function(){$(this).removeClass("zslion");})
    });
    $("#zsgun").hScrollPane({
        mover:"ul",
        moverW:function(){return $("#zsgun li").length*292-17;}(),
        showArrow:true,
        handleCssAlter:"draghandlealter"
    });

    document.getElementById("zsgun").style.height=document.getElementById("zhenliao").scrollHeight+"px";

// ajax 诊疗表添加form 提交
$('#diagnose_treat_submit').click(function(){
    $('#diagnoseTreatModal').modal('hide');
    $.ajax({
        url:'/diagnose_treat/create',
        type:'post',
        data: $('#diagnose_treat_form').serialize(),
        success:function(data){

            $("#diagnose_treat_show").html(data);

        },
        error:function(data){

            alert("添加失败！");
        }
    })
    return false;
});



    //    获取删除诊疗弹出框的方法
    var diagnoseTreatName;
    var diagnoseTreatID;
    function get_destroy_treat_modal(id,name){
        diagnoseTreatName=name;
        diagnoseTreatID=id;
        $('#diagnoseTreatDeleteModal').modal('show');
        $('#diagnoseTreatDeleteModal').on('shown.bs.modal',function(e){
            $('#showTName').html("你确定要删除名字为："+diagnoseTreatName+"的诊疗？");
        });
    };

    // 删除诊疗
    function destroy(){
        $.ajax({
            type:'post',
            url:'/diagnose_treat/destroy',
            data:{id:diagnoseTreatID},
            success:function(data){
                $('#diagnose_treat_show').html(data)
            }
        })

    };

//        点击左面诊疗标题，右边展现相关主诉，诊断等数据
        function showRightDiagonse(diagnoseTreatID,patient_id){
            $.ajax({
                url:'/diagnose_treat/show_treat_right',
                type:'get',
                data:{diagnose_treat_id:diagnoseTreatID,patient_id:patient_id},
                success:function(data){
                       $("#zhenliao_con").html(data);
                }
            })

        };
//        修改主诉
        function updateMainTell(diagnose_treat_id){
            $('#tellerModal').modal('show');
        };
    //        修改诊断
    function updateDiagnose(diagnose_treat_id){
        $('#diagnoseModal').modal('show');
    };
</script>

